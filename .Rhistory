)) %>% collect() %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
group_by(sigcond) %>%
slice_min(order_by = logFC, n = 12) %>%
pull(gene_name)
plotted_genes
mat <- pivot_wider(
data = h_obj,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
h_obj <- tbl(conn,norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
select(gene_name, contains("SRR")) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
View(h_obj)
View(h_obj)
values_table <- tbl(conn,norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
select(gene_name, contains("SRR")) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
annot <- values_table %>%
dplyr::select(sample_id, condition) %>%
unique() %>%
column_to_rownames("sample_id")
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
#plot
ann_colors <- c("red", "blue")
names(ann_colors) <- annot %>% pull(condition) %>% unique()
ann_colors <- list(condition = ann_colors)
plot_title <- paste0(pair[1], " vs. ", pair[2])
plt <- pheatmap(mat,
scale = "row",
angle_col = "45",
annotation_col = annot,
annotation_colors = ann_colors,
name = norm,
main = plot_title
)
pheatmap(mat,
scale = "row",
angle_col = "45",
annotation_col = annot,
annotation_colors = ann_colors,
name = norm,
main = plot_title
)
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%  distinct() %>%
column_to_rownames("gene_name") %>%
as.matrix()
plotted_genes <- tbl(conn, deg_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
group_by(sigcond) %>%
slice_min(order_by = logFC, n = 12) %>%
pull(gene_name)
values_table <- tbl(conn,norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
select(gene_name, contains("SRR")) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
View(values_table)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(
is.na(gene_name) ~ gene_id,
TRUE ~ gene_name
)) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
select(gene_name, contains("SRR")) %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
annot <- values_table %>%
dplyr::select(sample_id, condition) %>%
unique() %>%
column_to_rownames("sample_id")
View(annot)
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
pheatmap(mat,
scale = "row",
angle_col = "45",
annotation_col = annot,
annotation_colors = ann_colors,
name = norm,
main = plot_title
)
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
pwd
getwd()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
getwd()
runApp()
conn <- db_utils$get_db_connection()
box::use(
dplyr[...],
app/logic/db_utils,
)
conn <- db_utils$get_db_connection()
deg_table <- paste0(study,"_","degs")
norm_table <- paste0(study, "_", tolower(norm))
study <- "GSE83687"
norm <- "CPM"
contrast <- "Crohn vs. Control"
conn <- db_utils$get_db_connection()
deg_table <- paste0(study,"_","degs")
norm_table <- paste0(study, "_", tolower(norm))
pair <- strsplit(contrast, " vs. ")[[1]]
plotted_genes <- tbl(conn, deg_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene _name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
plotted_genes <- tbl(conn, deg_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene _name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
left_join()
plotted_genes <- tbl(conn, deg_table) %>%
dplyr::left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene _name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
plotted_genes <- tbl(conn, deg_table) %>%
dplyr::left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC) %>%
View()
pair
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == pair[1] & denominator == pair[2]) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC) %>%
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == pair[1] & denominator == pair[2]) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC)
num <- pair[1]
dem <- pair[2]
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC)
View(plotted_genes)
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC)%>%
filter(row_number() > max(row_number()) - 10 | row_number() <= 10)
runApp()
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(gene_name %in% plotted_genes)
box::use(
dplyr[...], tidyr[...],
app/logic/db_utils,
)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(gene_name %in% plotted_genes)
View(values_table)
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC)%>%
filter(row_number() > max(row_number()) - 10 | row_number() <= 10)%>%
pull(gene_name)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(gene_name %in% plotted_genes)
View(values_table)
values_table <- tbl(conn, norm_table) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
collect() %>%
pivot_longer(contains("SRR")) %>%
rename(sample_id = name) %>%
left_join(
tbl(conn, "metadata") %>% select(sample_id, condition) %>% collect(),
by = "sample_id"
) %>%
filter(condition == pair[[1]] | condition == pair[[2]]) %>%
filter(gene_name %in% plotted_genes)
runApp()
runApp()
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
box::use(
dplyr[...], tidyr[...], tibble[...],
app/logic/db_utils,
)
mat <- pivot_wider(
data = values_table,
id_cols = gene_name, names_from = sample_id, values_from = value
) %>%
column_to_rownames("gene_name") %>%
as.matrix()
View(mat)
runApp()
runApp()
runApp()
runApp()
values_table %>%
filter(gene_name == "INSL5")
values_table %>%
filter(gene_name == "INSL5") %>%
view()
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
arrange(logFC)%>%
filter(row_number() > max(row_number()) - 10 | row_number() <= 10)
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect()
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect()
plotted_genes <- tbl(conn, deg_table) %>%
filter(numerator == num & denominator == dem) %>%
left_join(tbl(conn, "ens2sym"), by = "gene_id") %>%
mutate(gene_name = case_when(is.na(gene_name) ~ gene_id,TRUE ~ gene_name
)) %>%
mutate(sigcond = case_when(
FDR > 0.05 ~ "n.s.",
abs(logFC) < 1 ~ "sig-only",
logFC > 1 ~ "Over-expressed",
logFC < -1 ~ "Under-expressed"
)) %>%
collect() %>%
filter(sigcond %in% c("Over-expressed", "Under-expressed")) %>%
group_by(sigcond) %>%
slice_min(order_by = FDR, n = 12)
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
library(BiocManager)
shiny::runApp()
renv::install("BiocManager")
renv::install("BH")
renv::install(c("BiocIO","DelayedArray","BiocIO","BiocParallel","GenomicAlignments"))
renv::install(c("GenomicFeatures","GenomicRanges","MatrixGenerics","Rhtslib"))
renv::install(c("GenomicRanges","MatrixGenerics","Rhtslib"))
renv::install(c("writeXLS","edgeR","enrichR","limma","locfit"))
renv::install(c("WriteXLS","edgeR","enrichR","limma","locfit"))
renv::snapshot()
